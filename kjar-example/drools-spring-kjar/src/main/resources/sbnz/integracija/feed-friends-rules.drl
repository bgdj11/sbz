
package rules;

import java.time.LocalDateTime;
import demo.facts.FriendFeedRequest;
import demo.facts.FriendIds;
import demo.facts.BlockedIds;
import demo.facts.PostFact;

global java.time.LocalDateTime NOW;
global java.util.List friendsFeedOut;

dialect "java"

rule "FriendsFeed: select recent friends posts with details"
    agenda-group "feed-friends-select"
when
    $friends : FriendIds($fids : ids)
    $blocked : BlockedIds($bids : ids)
    $p : PostFact($authorId : authorId, $createdAt : createdAt)
    eval($createdAt != null && $createdAt.isAfter(NOW.minusHours(24)))
    eval($fids != null && $fids.contains($authorId))
    eval($bids == null || !$bids.contains($authorId))
then
    friendsFeedOut.add($p);
end
